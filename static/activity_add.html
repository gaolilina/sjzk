<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>活动创建</title>
<link rel="stylesheet" href="css/style.css" />
<link rel="stylesheet" href="css/global.css" />
<link rel="stylesheet" href="css/DateTimePicker.min.css" />
<link rel="stylesheet" href="lib/Hui-iconfont/1.0.8/iconfont.css">
<link rel="stylesheet" href="css/jquery-confirm-3.0.3.min.css">
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/base.js"></script>
<script src="js/DateTimePicker.min.js"></script>
<script src="js/DatetimePicker-i18n-zh-CN.js"></script>
<script src="js/jquery-confirm-3.0.3.min.js"></script>
<script src="js/activity.js"></script>
<style type="text/css">
    #header{
        width: 100%;
        height: 80px;
        background: linear-gradient(to right, #0198CA , #00BBD9); /* 标准的语法 */
        color: #fff;
        font-size: 1.8em;
        padding-left: 30px;
        padding-top: 15px;
    }
    input[type="text"],input[type="textarea"],select{
        width: 300px;
    }
    input[type="button"]{
        margin-top: 0;
        width: 50px;
        height: 30px;
        background: #55CE63;
        color: white;
        border: 0 none;
        font-size: 1em;
        border-radius: 3px;
    }
    .buttons{
        float: right;
    }
</style>
</head>
<body>
<div id="header">活动创建</div>
<form role="form" action="" method="post">
<table>
    <tr>
        <td>标题：</td>
        <td><input name="name" type="text" value="" maxlength="50" required/></td>
    </tr>
    <tr>
        <td>标签：</td>
        <td><input name="tags" type="text" value="" maxlength="50" required/></td>

        <td>类型：</td>
        <td>
            <select name="type">
                <option value="" selected="selected">--请选择--</option>
                <option value="0">会议</option>
                <option value="1">讲座</option>
                <option value="2">培训</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>详细内容：</td>
        <td colspan="3"><textarea name="content" maxlength="1000" required></textarea></td>
    </tr>
    <tr>
        <td>参与者类型：</td>
        <td>
            <select name="user_type">
                <option value="0" selected="selected">不限</option>
                <option value="1">学生</option>
                <option value="2">教师</option>
                <option value="3">社会人员</option>
            </select>
        </td>
    </tr>
    <tr>
        <td>开始时间：</td>
        <td><input name="time_started" type="text" data-field="datetime" readonly value="" required/></td>
    
        <td>结束时间：</td>
        <td><input name="time_ended" type="text" data-field="datetime" readonly value="" required/></td>
    </tr>
    <tr>
        <td>人数上限：</td>
        <td><input name="allow_user" type="number" value="0" required/> (0为不限)</td>
    
        <td>省：</td>
        <td><input name="province" type="text" value=""/></td>
    </tr>
    <tr>
        <td>市：</td>
        <td><input name="city" type="text" value=""/></td>
    
        <td>机构：</td>
        <td><input name="unit" type="text" value=""/></td>
    </tr>
    
    <tr>
        <td>当前活动阶段：</td>
        <td>
            <input name="stages" type="hidden" value="" required/>
            <input name="status" type="hidden" value="" required/>
            <select id="status"></select>
            <input id="add_stage" type="button" value="新增" style="margin-top: 0px;" />
        </td>
    </tr>
    <tr>
        <td colspan="4">
            <div class="buttons">
                <input type="submit" value="保存" />
                <input type="reset" value="取消" />
            </div>
        </td>
    </tr>
<script>
var stage_count = 0;
</script>
</table>
</form>
<div id="dtBox"></div>
    <script>
        const token = getRequest()["token"];
        $(document).ready(function() {
            setDateTimePicker();
            $('.dir_warn').click(function(e) {
                if (!confirm($(this).data('warn-text'))) {
                    e.preventDefault();
                }
            });
        });
        function displayPopup() {
            if ($(document).width() >= 768) return false;
            return true;
        }
        function setDateTimePicker() {
            var bIsPopup = displayPopup();
            $("#dtBox").DateTimePicker({
                isPopup: bIsPopup,
                language: 'zh-CN'
            });
        }

        $('form').submit(function(e) {
            if ($('[name=time_started]').length > 0 && $('[name=time_end]').length > 0) {
                if (new Date($('[name=time_started]').val()) > new Date($('[name=time_end]').val())) {
                    e.preventDefault();
                    alert('时间设置有误');
                    return false;
                }
            }
            if ($('[name=time_started]').length > 0 && $('[name=deadline]').length > 0) {
                if (new Date($('[name=time_started]').val()) > new Date($('[name=deadline]').val())) {
                    e.preventDefault();
                    alert('时间设置有误');
                    return false;
                }
            }
            if ($('[name=deadline]').length > 0 && $('[name=time_end]').length > 0) {
                if (new Date($('[name=deadline]').val()) > new Date($('[name=time_end]').val())) {
                    e.preventDefault();
                    alert('时间设置有误');
                    return false;
                }
            }
            $.ajax({
                type: 'POST',
                url: base_url+"web/activity/",
                data:$('form').serialize(),
                dataType: 'json',
                headers: {'X-USER-TOKEN': token},
                error:function(data) {alert("提交失败!");},
                success: function(data){
                    alert("提交成功！");
                    window.location.reload();
                }
            });
            return false;
        });
    </script>
</body>

</html>

