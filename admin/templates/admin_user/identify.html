{% extends "layout.html" %}
{% load staticfiles %}
{% block content %}
<form role="form" action="{% url 'admin:admin_users:identify' %}" method="post">
<table>
    <tr>
        <td>手机号码：</td>
        <td><input name="phone_number" type="text" value="{{ u.phone_number }}" maxlength="11"/></td>
    </tr>
    <tr>
        <td>旧密码：</td>
        <td><input name="old_pass" type="password" value="" maxlength="20" required/></td>
    </tr>
    <tr>
        <td>新密码：</td>
        <td><input name="new_pass" type="password" value="" maxlength="18" required/></td>
    </tr>
    <tr>
        <td>确认新密码：</td>
        <td><input class="pass2" type="password" value="" maxlength="18" required/></td>
    </tr>
    <tr>
        <td>短信验证码</td>
        <td><input name="valid_code" type="text" value="" required/> <button>获取</button></td>
    </tr>
    <tr>
        <td>{{ msg }}</td>
        <td>
            <div class="buttons">
                <input type="submit" value="确定" />
            </div>
        </td>
    </tr>
</table>

</form>

<script>
$('button').click(function() {
    $.get("http://www.chuangyh.com:8000/user/validation_code/?phone_number" + $("input[name=phone_number]").val())
        .then(function() {
            $("button").prop("enabled", false);

            setTimeout(function() {
                $("button").prop("enabled", true);
            }, 60000);
        })
        .fail(function() {
            alert("发送失败，请重试");
        });
});

$('form').submit(function(e) {
    if ($("input[name=new_pass]").val() != $(".pass2").val()) {
        alert('密码不一致');
        e.preventDefault();
    }
});
</script>
{% endblock %}

{% block topbar %}{% include 'topbar.html' with tb=1 %}{% endblock %}
{% block leftbar %}{% include 'leftbar.html' with tb=1 lb=3 %}{% endblock %}
{% block rightbar %}{% include 'rightbar.html' with tb=1 lb=3 rb=1 %}{% endblock %}

{% block css %}
<style>
    form {
        padding: 30px;
    }
    form img {
        width: 100px;
        height: 100px;
    }
    td {
        padding: 5px 8px;
        vertical-align: top;
    }

    input[type=text], input[type=email], textarea {
        border: 2px solid #C5DBAD;
    }

    input[type=radio] {
        margin-right: 5px;
    }

    input[type=radio] ~ input {
        margin-left: 15px;
    }

    .buttons {
        float: right;
    }

    input[type=submit], input[type=reset] {
        border: 0 none;
        border-radius: 3px;
        padding: 2px 5px;
        background: #85A365;
        color: white;
        margin-left: 10px;
        margin-top: 10px;
    }
</style>
{% endblock %}
